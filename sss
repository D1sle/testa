local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")

local player = Players.LocalPlayer

local function create(className, props)
    local inst = Instance.new(className)
    if props then
        for k, v in pairs(props) do
            inst[k] = v
        end
    end
    return inst
end

local function makeDraggable(frame, dragHandle)
    dragHandle = dragHandle or frame
    local dragging = false
    local dragStart = Vector2.new()
    local startPos = UDim2.new()

    local function update(input)
        local delta = input.Position - dragStart
        frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end

    dragHandle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    dragHandle.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            update(input)
        end
    end)
end

local Framework = {}
Framework.__index = Framework

local Window = {}
Window.__index = Window

local Tab = {}
Tab.__index = Tab

local Section = {}
Section.__index = Section

function Framework.new()
    local self = setmetatable({}, Framework)
    return self
end

function Framework:CreateWindow(opts)
    opts = opts or {}
    local title = opts.Title or "Script Hub"
    local size = opts.Size or UDim2.new(0, 520, 0, 360)
    local accent = opts.AccentColor or Color3.fromRGB(90, 130, 255)
    local background = opts.BackgroundColor or Color3.fromRGB(18, 18, 24)

    local gui = create("ScreenGui", {
        Name = "InforgeUI",
        ResetOnSpawn = false,
        Parent = player:WaitForChild("PlayerGui")
    })

    local main = create("Frame", {
        Parent = gui,
        Size = size,
        Position = UDim2.new(0.5, -size.X.Offset / 2, 0.5, -size.Y.Offset / 2),
        BackgroundColor3 = background,
        BorderSizePixel = 0
    })

    create("UICorner", {
        Parent = main,
        CornerRadius = UDim.new(0, 12)
    })

    create("UIStroke", {
        Parent = main,
        Color = Color3.fromRGB(60, 60, 90),
        Thickness = 1,
        Transparency = 0.4
    })

    local header = create("Frame", {
        Parent = main,
        Size = UDim2.new(1, 0, 0, 46),
        BackgroundColor3 = Color3.fromRGB(24, 24, 34),
        BorderSizePixel = 0
    })

    create("UICorner", {
        Parent = header,
        CornerRadius = UDim.new(0, 12)
    })

    local titleLabel = create("TextLabel", {
        Parent = header,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -20, 1, 0),
        Position = UDim2.new(0, 12, 0, 0),
        Text = title,
        TextColor3 = Color3.fromRGB(235, 235, 235),
        Font = Enum.Font.GothamBold,
        TextSize = 16,
        TextXAlignment = Enum.TextXAlignment.Left
    })

    local tabBar = create("Frame", {
        Parent = main,
        Position = UDim2.new(0, 0, 0, 46),
        Size = UDim2.new(0, 140, 1, -46),
        BackgroundColor3 = Color3.fromRGB(20, 20, 28),
        BorderSizePixel = 0
    })

    local tabList = create("UIListLayout", {
        Parent = tabBar,
        Padding = UDim.new(0, 6),
        HorizontalAlignment = Enum.HorizontalAlignment.Center,
        VerticalAlignment = Enum.VerticalAlignment.Top
    })

    create("UIPadding", {
        Parent = tabBar,
        PaddingTop = UDim.new(0, 10),
        PaddingBottom = UDim.new(0, 10)
    })

    local content = create("Frame", {
        Parent = main,
        Position = UDim2.new(0, 140, 0, 46),
        Size = UDim2.new(1, -140, 1, -46),
        BackgroundTransparency = 1
    })

    makeDraggable(main, header)

    local window = setmetatable({
        Gui = gui,
        Main = main,
        Content = content,
        TabBar = tabBar,
        Tabs = {},
        Accent = accent
    }, Window)

    return window
end

function Window:CreateTab(name, iconText)
    name = name or "Tab"
    iconText = iconText or ""

    local btn = create("TextButton", {
        Parent = self.TabBar,
        Size = UDim2.new(1, -12, 0, 32),
        BackgroundColor3 = Color3.fromRGB(28, 28, 40),
        BorderSizePixel = 0,
        Text = (iconText ~= "" and (iconText .. "  ") or "") .. name,
        TextColor3 = Color3.fromRGB(200, 200, 200),
        Font = Enum.Font.GothamMedium,
        TextSize = 13
    })

    create("UICorner", {
        Parent = btn,
        CornerRadius = UDim.new(0, 8)
    })

    local page = create("ScrollingFrame", {
        Parent = self.Content,
        Size = UDim2.new(1, 0, 1, 0),
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollBarThickness = 6,
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Visible = false
    })

    local layout = create("UIListLayout", {
        Parent = page,
        Padding = UDim.new(0, 10),
        HorizontalAlignment = Enum.HorizontalAlignment.Center,
        VerticalAlignment = Enum.VerticalAlignment.Top
    })

    create("UIPadding", {
        Parent = page,
        PaddingTop = UDim.new(0, 10),
        PaddingLeft = UDim.new(0, 12),
        PaddingRight = UDim.new(0, 12),
        PaddingBottom = UDim.new(0, 12)
    })

    layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        page.CanvasSize = UDim2.new(0, 0, 0, layout.AbsoluteContentSize.Y + 12)
    end)

    local tab = setmetatable({
        Button = btn,
        Page = page,
        Accent = self.Accent
    }, Tab)

    btn.MouseButton1Click:Connect(function()
        for _, t in pairs(self.Tabs) do
            t.Page.Visible = false
            t.Button.BackgroundColor3 = Color3.fromRGB(28, 28, 40)
            t.Button.TextColor3 = Color3.fromRGB(200, 200, 200)
        end
        tab.Page.Visible = true
        tab.Button.BackgroundColor3 = self.Accent
        tab.Button.TextColor3 = Color3.fromRGB(255, 255, 255)
    end)

    table.insert(self.Tabs, tab)
    if #self.Tabs == 1 then
        btn:Activate()
        tab.Page.Visible = true
        tab.Button.BackgroundColor3 = self.Accent
        tab.Button.TextColor3 = Color3.fromRGB(255, 255, 255)
    end

    return tab
end

function Tab:CreateSection(title)
    local sectionFrame = create("Frame", {
        Parent = self.Page,
        Size = UDim2.new(1, 0, 0, 40),
        BackgroundColor3 = Color3.fromRGB(24, 24, 34),
        BorderSizePixel = 0
    })

    create("UICorner", {
        Parent = sectionFrame,
        CornerRadius = UDim.new(0, 10)
    })

    local header = create("TextLabel", {
        Parent = sectionFrame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -20, 0, 28),
        Position = UDim2.new(0, 10, 0, 6),
        Text = title or "Section",
        TextColor3 = Color3.fromRGB(220, 220, 220),
        Font = Enum.Font.GothamSemibold,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left
    })

    local list = create("UIListLayout", {
        Parent = sectionFrame,
        Padding = UDim.new(0, 8),
        HorizontalAlignment = Enum.HorizontalAlignment.Center,
        VerticalAlignment = Enum.VerticalAlignment.Top
    })

    create("UIPadding", {
        Parent = sectionFrame,
        PaddingTop = UDim.new(0, 32),
        PaddingLeft = UDim.new(0, 10),
        PaddingRight = UDim.new(0, 10),
        PaddingBottom = UDim.new(0, 10)
    })

    list:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        sectionFrame.Size = UDim2.new(1, 0, 0, list.AbsoluteContentSize.Y + 42)
    end)

    local section = setmetatable({
        Frame = sectionFrame,
        Accent = self.Accent
    }, Section)

    return section
end

local function makeButton(parent, text, callback, accent)
    local btn = create("TextButton", {
        Parent = parent,
        Size = UDim2.new(1, 0, 0, 30),
        BackgroundColor3 = accent,
        BorderSizePixel = 0,
        Text = text or "Button",
        TextColor3 = Color3.fromRGB(255, 255, 255),
        Font = Enum.Font.GothamBold,
        TextSize = 12
    })

    create("UICorner", {
        Parent = btn,
        CornerRadius = UDim.new(0, 8)
    })

    btn.MouseButton1Click:Connect(function()
        if callback then
            callback()
        end
    end)

    return btn
end

function Section:AddButton(text, callback)
    return makeButton(self.Frame, text, callback, self.Accent)
end

function Section:AddToggle(text, default, callback)
    local state = default and true or false
    local holder = create("Frame", {
        Parent = self.Frame,
        Size = UDim2.new(1, 0, 0, 30),
        BackgroundTransparency = 1
    })

    local label = create("TextLabel", {
        Parent = holder,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -50, 1, 0),
        Text = text or "Toggle",
        TextColor3 = Color3.fromRGB(210, 210, 210),
        Font = Enum.Font.Gotham,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left
    })

    local toggle = create("TextButton", {
        Parent = holder,
        Size = UDim2.new(0, 36, 0, 20),
        Position = UDim2.new(1, -36, 0.5, -10),
        BackgroundColor3 = state and self.Accent or Color3.fromRGB(80, 80, 80),
        BorderSizePixel = 0,
        Text = ""
    })

    create("UICorner", {
        Parent = toggle,
        CornerRadius = UDim.new(1, 0)
    })

    local knob = create("Frame", {
        Parent = toggle,
        Size = UDim2.new(0, 16, 0, 16),
        Position = state and UDim2.new(1, -18, 0.5, -8) or UDim2.new(0, 2, 0.5, -8),
        BackgroundColor3 = Color3.fromRGB(240, 240, 240),
        BorderSizePixel = 0
    })

    create("UICorner", {
        Parent = knob,
        CornerRadius = UDim.new(1, 0)
    })

    local function setState(nextState)
        state = nextState
        local goal = state and self.Accent or Color3.fromRGB(80, 80, 80)
        local knobPos = state and UDim2.new(1, -18, 0.5, -8) or UDim2.new(0, 2, 0.5, -8)
        if TweenService then
            TweenService:Create(toggle, TweenInfo.new(0.15), {BackgroundColor3 = goal}):Play()
            TweenService:Create(knob, TweenInfo.new(0.15), {Position = knobPos}):Play()
        else
            toggle.BackgroundColor3 = goal
            knob.Position = knobPos
        end
        if callback then
            callback(state)
        end
    end

    toggle.MouseButton1Click:Connect(function()
        setState(not state)
    end)

    return {
        Set = setState,
        Get = function() return state end
    }
end

function Section:AddSlider(text, min, max, default, callback)
    min = min or 0
    max = max or 100
    default = math.clamp(default or min, min, max)

    local holder = create("Frame", {
        Parent = self.Frame,
        Size = UDim2.new(1, 0, 0, 40),
        BackgroundTransparency = 1
    })

    local label = create("TextLabel", {
        Parent = holder,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 18),
        Text = string.format("%s: %d", text or "Slider", default),
        TextColor3 = Color3.fromRGB(210, 210, 210),
        Font = Enum.Font.Gotham,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left
    })

    local track = create("Frame", {
        Parent = holder,
        Size = UDim2.new(1, 0, 0, 12),
        Position = UDim2.new(0, 0, 0, 22),
        BackgroundColor3 = Color3.fromRGB(60, 60, 70),
        BorderSizePixel = 0
    })

    create("UICorner", {
        Parent = track,
        CornerRadius = UDim.new(1, 0)
    })

    local fill = create("Frame", {
        Parent = track,
        Size = UDim2.new((default - min) / (max - min), 0, 1, 0),
        BackgroundColor3 = self.Accent,
        BorderSizePixel = 0
    })

    create("UICorner", {
        Parent = fill,
        CornerRadius = UDim.new(1, 0)
    })

    local dragging = false

    local function setValueFromX(x)
        local rel = math.clamp((x - track.AbsolutePosition.X) / track.AbsoluteSize.X, 0, 1)
        local value = math.floor(min + (max - min) * rel)
        fill.Size = UDim2.new((value - min) / (max - min), 0, 1, 0)
        label.Text = string.format("%s: %d", text or "Slider", value)
        if callback then
            callback(value)
        end
    end

    track.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            setValueFromX(input.Position.X)
        end
    end)

    track.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            setValueFromX(input.Position.X)
        end
    end)

    return {
        Set = function(v)
            v = math.clamp(v, min, max)
            local rel = (v - min) / (max - min)
            fill.Size = UDim2.new(rel, 0, 1, 0)
            label.Text = string.format("%s: %d", text or "Slider", v)
            if callback then
                callback(v)
            end
        end
    }
end

function Section:AddLabel(text)
    return create("TextLabel", {
        Parent = self.Frame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 18),
        Text = text or "Label",
        TextColor3 = Color3.fromRGB(200, 200, 200),
        Font = Enum.Font.Gotham,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left
    })
end

return Framework.new()
